/*
 * AppNexus HTML5 library
 * Author: Alejandro Gonzalez Sole (jgonzalezsole@appnexus.com) 
 * Website: http://www.appnexus.com
 * MIT Licensed.
 *
 * appnexus-html5-lib 0.0.5
 */
 !function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=a("../lib/guid"),e=a("../lib/utils"),f=a("../lib/porthole");b.exports.placement=function(a){return function(b,c,g,h){function i(a,b){return a.style.top=a.style.left=a.style.right=a.style.bottom=0,a.style.width=a.style.height="100%",a.style.position="fixed",a.style.zIndex=b,a}function j(a,b){a.style["-webkit-transition"]=b,a.style["-moz-transition"]=b,a.style["-ms-transition"]=b,a.style.transition=b}function k(b){var c;try{c=b.contentWindow?b.contentWindow.document:b.contentDocument.document?b.contentDocument.document:b.contentDocument}catch(d){a.debug&&console.error("Error getting iframe document: "+d)}return c}function l(a,b){for(var c,d=a.document.getElementsByTagName("iframe"),e=d.length;e-- >0;){var f=k(d[e]);if(f===b){c=d[e];break}}return c}function m(a,b){b.expand&&(b.expand.easing||b.expand.duration)&&j(a,e.sprintf("width, height, %sms %s",parseInt(b.expand.duration||400,10),b.expand.easing)),b.interstitial||(isNaN(b.height)||(a.style.height=b.height+"px"),isNaN(b.width)||(a.style.width=b.width+"px"))}function n(a,b){b.collapse&&(b.collapse.easing||b.collapse.duration)&&j(a,e.sprintf("width, height, %sms %s",parseInt(b.collapse.duration||400,10),b.collapse.easing)),a.style.height=h+"px",a.style.width=g+"px"}function o(a,b,c){a.overlay=document.createElement("div"),a.overlay.style.backgroundColor=c.overlayColor||"rgba(0,0,0,0.5)",document.body.appendChild(a.overlay),i(a.overlay,b)}function p(a,b){a.overlay&&(a.overlay.parentNode.removeChild(a.overlay),a.overlay=null)}a.debug&&console.info("Host placement created");var q=d(),r="undefined"!=typeof inDapIF&&inDapIF,s={},t=new f.WindowProxy(null,"an-"+q);return t.addEventListener(function(a){var b=document.getElementById("an-"+q),d=r?l(window.parent,document):!1,f=r?window.parent.window:window,j=r?d.parentNode:b.parentNode,k=r?d:b;switch(a.data.action){case"click":f.open(c,"_blank");break;case"set-expand-properties":s=a.data.properties||{},s.interstitial&&(s.floating=!1),s.floating&&(k.style.position="absolute",j.style.position="relative",j.style.minWidth=g+"px",j.style.minHeight=h+"px",s.anchor&&(/^top-/.test(s.anchor)&&(k.style.top="0px"),/-left$/.test(s.anchor)&&(k.style.left="0px"),/-right$/.test(s.anchor)&&(k.style.right="0px"),/^bottom-/.test(s.anchor)&&(k.style.bottom="0px"))),s.expand&&(s.collapse=e.deepExtend({},s.expand,s.collapse));break;case"expand":s.interstitial&&(o(k,99998,s),i(k,99999),setTimeout(function(){i(b,1e5)},100)),m(b,s),d&&m(d,s);break;case"ready":var u={landingPageUrl:c};t.post({action:"setAdData",parameters:u});break;case"collapse":s.interstitial&&p(k,s),n(b,s),d&&n(d,s)}}),document.write('<div><iframe id="an-'+q+'" name="an-'+q+'" src="'+b+'" width="'+g+'" height="'+h+'" frameborder="0" scrolling="no" allowfullscreen="true" style="width: '+g+"px; height: "+h+'px; "></iframe></div>'),document.getElementById("an-"+q)}}},{"../lib/guid":4,"../lib/porthole":5,"../lib/utils":6}],2:[function(a,b,c){"use strict";function d(){var a=this;this.debug=!1,this.inFrame=!1,this.EventListener=f;var b,c=!1,d=!1,h={},i=new f,j={};try{this.inFrame=window.self!==window.top}catch(k){this.inFrame=!0}i.addEventListener("ready",function(){c&&(l(),a.debug&&console.info("Client initialized!"))});var l=function(){b=new e.WindowProxy,b.addEventListener(o),b.post({action:"ready"})},m=function(a){/in/.test(document.readyState)?setTimeout(function(){m(a)},9):a()};m(function(){d=!0,i.dispatchEvent("ready")});var n=function(a){window.open(a,"_blank")},o=function(a){switch(a.data.action){case"setAdData":j=a.data.parameters}};this.ready=function(b){c||(c=!0,a.debug=!a.inFrame,"function"==typeof b&&i.addEventListener("ready",b),d&&i.dispatchEvent("ready"))},this.click=function(){if(!c||!b)throw new Error("APPNEXUS library has not been initialized. APPNEXUS.ready() must be called first");n(j.landingPageUrl),a.debug&&console.info("Client send action: click")},this.setExpandProperties=function(d){if(!c||!b)throw new Error("APPNEXUS library has not been initialized. APPNEXUS.ready() must be called first");h=d,b.post({action:"set-expand-properties",properties:d}),a.debug&&console.info("Client send action: set-expand-properties")},this.getExpandProperties=function(){return h},this.expand=function(){if(!c||!b)throw new Error("APPNEXUS library has not been initialized. APPNEXUS.ready() must be called first");b.post({action:"expand"}),a.debug&&console.info("Client send action: expand")},this.collapse=function(){if(!c||!b)throw new Error("APPNEXUS library has not been initialized. APPNEXUS.ready() must be called first");b.post({action:"collapse"}),a.debug&&console.info("Client send action: collapse")},this.placement=g.placement(this)}var e=a("./lib/porthole"),f=a("./lib/event-listener"),g=a("./host"),h=new d;"undefined"!=typeof window&&(window.APPNEXUS=h),b.exports=h},{"./host":1,"./lib/event-listener":3,"./lib/porthole":5}],3:[function(a,b,c){function d(){this.__listeners__=[]}d.prototype.addEventListener=function(a,b){this.__listeners__.push({callback:b,name:a})},d.prototype.removeEventListener=function(a,b){for(var c=this.__listeners__.length-1;c>=0;c--)this.__listeners__[c].name===a&&this.__listeners__[c].callback===b&&this.__listeners__.splice(c,1)},d.prototype.dispatchEvent=function(a){for(var b=this.__listeners__.length-1;b>=0;b--)this.__listeners__[this.__listeners__.length-b-1].name===a&&this.__listeners__[this.__listeners__.length-b-1].callback()},b.exports=d},{}],4:[function(a,b,c){b.exports=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}},{}],5:[function(a,b,c){var d=!1,e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,f=function(){};f.extend=function(a){function b(){!d&&this.init&&this.init.apply(this,arguments)}var c=this.prototype;d=!0;var f=new this;d=!1;for(var g in a)f[g]="function"==typeof a[g]&&"function"==typeof c[g]&&e.test(a[g])?function(a,b){return function(){var d=this._super;this._super=c[a];var e=b.apply(this,arguments);return this._super=d,e}}(g,a[g]):a[g];return b.prototype=f,b.prototype.constructor=b,b.extend=arguments.callee,b};var g={debug:!1,trace:function(a){this.debug&&void 0!==window.console&&window.console.log("Porthole: "+a)},error:function(a){void 0!==typeof window.console&&"function"==typeof window.console.error&&window.console.error("Porthole: "+a)}};g.WindowProxy=function(){},g.WindowProxy.prototype={post:function(a,b){},addEventListener:function(a){},removeEventListener:function(a){}},g.WindowProxyBase=f.extend({init:function(a){void 0===a&&(a=""),this.targetWindowName=a,this.origin=window.location.protocol+"//"+window.location.host,this.eventListeners=[]},getTargetWindowName:function(){return this.targetWindowName},getOrigin:function(){return this.origin},getTargetWindow:function(){return g.WindowProxy.getTargetWindow(this.targetWindowName)},post:function(a,b){void 0===b&&(b="*"),this.dispatchMessage({data:a,sourceOrigin:this.getOrigin(),targetOrigin:b,sourceWindowName:window.name,targetWindowName:this.getTargetWindowName()})},addEventListener:function(a){return this.eventListeners.push(a),a},removeEventListener:function(a){var b;try{b=this.eventListeners.indexOf(a),this.eventListeners.splice(b,1)}catch(c){this.eventListeners=[]}},dispatchEvent:function(a){var b;for(b=0;b<this.eventListeners.length;b++)try{this.eventListeners[b](a)}catch(c){g.error(c)}}}),g.WindowProxyLegacy=g.WindowProxyBase.extend({init:function(a,b){this._super(b),null!==a?(this.proxyIFrameName=this.targetWindowName+"ProxyIFrame",this.proxyIFrameLocation=a,this.proxyIFrameElement=this.createIFrameProxy()):(this.proxyIFrameElement=null,g.trace("proxyIFrameUrl is null, window will be a receiver only"),this.post=function(){throw new Error("Receiver only window")})},createIFrameProxy:function(){var a=document.createElement("iframe");return a.setAttribute("id",this.proxyIFrameName),a.setAttribute("name",this.proxyIFrameName),a.setAttribute("src",this.proxyIFrameLocation),a.setAttribute("frameBorder","1"),a.setAttribute("scrolling","auto"),a.setAttribute("width",30),a.setAttribute("height",30),a.setAttribute("style","position: absolute; left: -100px; top:0px;"),a.style.setAttribute&&a.style.setAttribute("cssText","position: absolute; left: -100px; top:0px;"),document.body.appendChild(a),a},dispatchMessage:function(a){var b=window.encodeURIComponent;if(this.proxyIFrameElement){var c=this.proxyIFrameLocation+"#"+b(g.WindowProxy.serialize(a));this.proxyIFrameElement.setAttribute("src",c),this.proxyIFrameElement.height=this.proxyIFrameElement.height>50?50:100}}}),g.WindowProxyHTML5=g.WindowProxyBase.extend({init:function(a,b){this._super(b),this.eventListenerCallback=null},dispatchMessage:function(a){this.getTargetWindow().postMessage(g.WindowProxy.serialize(a),a.targetOrigin)},addEventListener:function(a){if(0===this.eventListeners.length){var b=this;window.addEventListener?(this.eventListenerCallback=function(a){b.eventListener(b,a)},window.addEventListener("message",this.eventListenerCallback,!1)):window.attachEvent&&(this.eventListenerCallback=function(a){b.eventListener(b,window.event)},window.attachEvent("onmessage",this.eventListenerCallback))}return this._super(a)},removeEventListener:function(a){this._super(a),0===this.eventListeners.length&&(window.removeEventListener?window.removeEventListener("message",this.eventListenerCallback):window.detachEvent&&("undefined"==typeof window.onmessage&&(window.onmessage=null),window.detachEvent("onmessage",this.eventListenerCallback)),this.eventListenerCallback=null)},eventListener:function(a,b){var c=g.WindowProxy.unserialize(b.data);!c||""!==a.targetWindowName&&c.sourceWindowName!=a.targetWindowName||a.dispatchEvent(new g.MessageEvent(c.data,b.origin,a))}}),window.postMessage?(g.trace("Using built-in browser support"),g.WindowProxy=g.WindowProxyHTML5.extend({})):(g.trace("Using legacy browser support"),g.WindowProxy=g.WindowProxyLegacy.extend({})),g.WindowProxy.serialize=function(a){if("undefined"==typeof JSON)throw new Error("Porthole serialization depends on JSON!");return JSON.stringify(a)},g.WindowProxy.unserialize=function(a){if("undefined"==typeof JSON)throw new Error("Porthole unserialization dependens on JSON!");try{var b=JSON.parse(a)}catch(c){return!1}return b},g.WindowProxy.getTargetWindow=function(a){return""===a?window.parent:"top"===a||"parent"===a?window[a]:window.frames[a]},g.MessageEvent=function(a,b,c){this.data=a,this.origin=b,this.source=c},g.WindowProxyDispatcher={forwardMessageEvent:function(a){var b,c,d,e=window.decodeURIComponent;document.location.hash.length>0&&(b=g.WindowProxy.unserialize(e(document.location.hash.substr(1))),c=g.WindowProxy.getTargetWindow(b.targetWindowName),d=g.WindowProxyDispatcher.findWindowProxyObjectInWindow(c,b.sourceWindowName),d?d.origin===b.targetOrigin||"*"===b.targetOrigin?d.dispatchEvent(new g.MessageEvent(b.data,b.sourceOrigin,d)):g.error("Target origin "+d.origin+" does not match desired target of "+b.targetOrigin):g.error("Could not find window proxy object on the target window"))},findWindowProxyObjectInWindow:function(a,b){var c;if(a)for(c in a)if(Object.prototype.hasOwnProperty.call(a,c))try{if(null!==a[c]&&"object"==typeof a[c]&&a[c]instanceof a.Porthole.WindowProxy&&a[c].getTargetWindowName()===b)return a[c]}catch(d){}return null},start:function(){window.addEventListener?window.addEventListener("resize",g.WindowProxyDispatcher.forwardMessageEvent,!1):window.attachEvent&&"undefined"!==window.postMessage?window.attachEvent("onresize",g.WindowProxyDispatcher.forwardMessageEvent):document.body.attachEvent?window.attachEvent("onresize",g.WindowProxyDispatcher.forwardMessageEvent):g.error("Cannot attach resize event")}},b.exports=g},{}],6:[function(a,b,c){var d={sprintf:function(a){var b=arguments,c=0;return a.replace(/%s/g,function(a,d){return b[++c]})},deepExtend:function(a){a=a||{};for(var b=1;b<arguments.length;b++){var c=arguments[b];if(c)for(var e in c)c.hasOwnProperty(e)&&("object"==typeof c[e]?a[e]=d.deepExtend(a[e],c[e]):a[e]=c[e])}return a}};b.exports=d},{}]},{},[2]);